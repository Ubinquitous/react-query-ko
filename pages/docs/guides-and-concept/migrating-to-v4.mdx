---
id: migrating-to-react-query-4
title: Migrating to React Query 4
---

## Migrating to React Query 4

## Breaking Changes

v4ëŠ” ì£¼ìš” ë²„ì „ ì—…ë°ì´íŠ¸ë¡œ, ëª‡ ê°€ì§€ ì£¼ìš” ë³€ê²½ ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤:

### react-query is now @tanstack/react-query

ì´ì œ `react-query`ëŠ” `@tanstack/react-query`ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì¢…ì†ì„±ì„ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤:

```
npm uninstall react-query
npm install @tanstack/react-query
npm install @tanstack/react-query-devtools
```

```tsx
- import { useQuery } from 'react-query' // [!code --]
- import { ReactQueryDevtools } from 'react-query/devtools' // [!code --]

+ import { useQuery } from '@tanstack/react-query' // [!code ++]
+ import { ReactQueryDevtools } from '@tanstack/react-query-devtools' // [!code ++]
```

#### Codemod

ì´ì „ì˜ importë¥¼ ìƒˆ ë²„ì „ì— ë§ê²Œ ìë™ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” codemodê°€ ì œê³µë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ import ë³€ê²½ ì‘ì—…ì„ ë” ì‰½ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì½”ë“œ ìƒì„± í›„ì—ëŠ” ë°˜ë“œì‹œ ê²€í† í•´ ì£¼ì‹œê³ , ë¡œê·¸ ì¶œë ¥ì„ ì£¼ì˜ ê¹Šê²Œ ì‚´í´ë³´ì„¸ìš”.

`.js` ë˜ëŠ” `.jsx` íŒŒì¼ì— ì ìš©í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```
npx jscodeshift ./path/to/src/ \
  --extensions=js,jsx \
  --transform=./node_modules/@tanstack/react-query/codemods/v4/replace-import-specifier.js
```

`.ts` ë˜ëŠ” `.tsx` íŒŒì¼ì— ì ìš©í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```
npx jscodeshift ./path/to/src/ \
  --extensions=ts,tsx \
  --parser=tsx \
  --transform=./node_modules/@tanstack/react-query/codemods/v4/replace-import-specifier.js
```

`TypeScript`ì˜ ê²½ìš° `tsx`ë¥¼ íŒŒì„œë¡œ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ codemodê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**Note:** codemodë¥¼ ì ìš©í•œ í›„ì—ëŠ” ì½”ë“œ í¬ë§·íŒ…ì´ ê¹¨ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ `prettier` ë°/ë˜ëŠ” `eslint`ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”!

**Note:** codemodëŠ” ì˜¤ì§ importë§Œ ë³€ê²½í•˜ë©°, devtools íŒ¨í‚¤ì§€ëŠ” ë³„ë„ë¡œ ìˆ˜ë™ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

### Query Keys (and Mutation Keys) need to be an Array

v3ì—ì„œëŠ” Query ë° Mutation Keysë¥¼ ë¬¸ìì—´ ë˜ëŠ” ë°°ì—´ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆì§€ë§Œ, React QueryëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë°°ì—´ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ëª¨ë“  APIì—ì„œ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´, ì´ì œ ëª¨ë“  í‚¤ëŠ” ë°°ì—´ë§Œ í—ˆìš©ë©ë‹ˆë‹¤:

```tsx
-useQuery("todos", fetchTodos) + // [!code --]
  useQuery(["todos"], fetchTodos); // [!code ++]
```

#### Codemod

ì´ ë³€ê²½ì„ ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆë„ë¡ codemodê°€ ì œê³µë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë°°ì—´ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`.js` ë˜ëŠ” `.jsx` íŒŒì¼ì— ì ìš©í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```
npx jscodeshift ./path/to/src/ \
  --extensions=js,jsx \
  --transform=./node_modules/@tanstack/react-query/codemods/v4/key-transformation.js
```

`.ts` ë˜ëŠ” `.tsx` íŒŒì¼ì— ì ìš©í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```
npx jscodeshift ./path/to/src/ \
  --extensions=ts,tsx \
  --parser=tsx \
  --transform=./node_modules/@tanstack/react-query/codemods/v4/key-transformation.js
```

TypeScriptì˜ ê²½ìš° `tsx`ë¥¼ íŒŒì„œë¡œ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ codemodê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**Note:** codemodë¥¼ ì ìš©í•œ í›„ì—ëŠ” ì½”ë“œ í¬ë§·íŒ…ì´ ê¹¨ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ `prettier` ë°/ë˜ëŠ” `eslint`ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”!

### The idle state has been removed

ìƒˆë¡œìš´ `fetchStatus`ê°€ ë„ì…ë˜ë©´ì„œ `idle` ìƒíƒœëŠ” ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ `fetchStatus: 'idle'`ë¡œ ë™ì¼í•œ ìƒíƒœë¥¼ ë” ì˜ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ë¡œ `disabled` ì¿¼ë¦¬ì— ì˜í–¥ì„ ë¯¸ì¹˜ë©°, ì´ì „ì—ëŠ” `idle` ìƒíƒœì˜€ë˜ ì¿¼ë¦¬ëŠ” ì´ì œ `loading` ìƒíƒœë¡œ í‘œì‹œë©ë‹ˆë‹¤:

```tsx
- status: 'idle' // [!code --]
+ status: 'loading'  // [!code ++]
+ fetchStatus: 'idle' // [!code ++]
```

`disabled` ì¿¼ë¦¬ëŠ” ì´ì œ `loading` ìƒíƒœë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ë”°ë¼ì„œ `isLoading` ëŒ€ì‹  `isInitialLoading`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤:

```tsx
-isLoading + // [!code --]
  isInitialLoading; // [!code ++]
```

### new API for `useQueries`

`useQueries` í›…ì€ ì´ì œ `queries` propì´ ìˆëŠ” ê°ì²´ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ìŠµë‹ˆë‹¤. `queries` propì˜ ê°’ì€ ì¿¼ë¦¬ ë°°ì—´ì…ë‹ˆë‹¤:

```tsx
-useQueries([
  { queryKey1, queryFn1, options1 },
  { queryKey2, queryFn2, options2 },
]) + // [!code --]
  useQueries({
    queries: [
      { queryKey1, queryFn1, options1 },
      { queryKey2, queryFn2, options2 },
    ],
  }); // [!code ++]
```

### Undefined is an illegal cache value for successful queries

ì—…ë°ì´íŠ¸ë¥¼ ì¤‘ë‹¨í•  ìˆ˜ ìˆë„ë¡ `undefined`ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆì§€ë§Œ, `undefined`ëŠ” ì´ì œ ìœ íš¨í•œ ìºì‹œ ê°’ì´ ì•„ë‹™ë‹ˆë‹¤. `undefined`ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì€ ì´ì œ í—ˆìš©ë˜ì§€ ì•Šìœ¼ë©°, ëŸ°íƒ€ì„ì—ì„œ ì‹¤íŒ¨í•œ `Promise`ë¡œ ë³€í™˜ë˜ì–´ ì—ëŸ¬ê°€ ë°œìƒí•˜ê³ , ê°œë°œ ëª¨ë“œì—ì„œëŠ” ì½˜ì†”ì— ê¸°ë¡ë©ë‹ˆë‹¤.

### Queries and mutations, per default, need network connection to run

ê¸°ë³¸ì ìœ¼ë¡œ ì¿¼ë¦¬ì™€ ë®¤í…Œì´ì…˜ì€ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ì—†ìœ¼ë©´ `paused` ìƒíƒœê°€ ë©ë‹ˆë‹¤. ì´ì „ ë™ì‘ì„ ìœ ì§€í•˜ë ¤ë©´ `networkMode: offlineFirst`ë¥¼ ê¸€ë¡œë²Œë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```tsx
new QueryClient({
  defaultOptions: {
    queries: {
      networkMode: "offlineFirst",
    },
    mutations: {
      networkMode: "offlineFirst",
    },
  },
});
```

### `notifyOnChangeProps` property no longer accepts `"tracked"` as a value

`notifyOnChangeProps` ì˜µì…˜ì´ ë” ì´ìƒ `"tracked"` ê°’ì„ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëŒ€ì‹ , `useQuery`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì†ì„±ì„ ì¶”ì í•©ë‹ˆë‹¤. `notifyOnChangeProps: "tracked"`ì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì¿¼ë¦¬ëŠ” ì´ ì˜µì…˜ì„ ì œê±°í•´ì•¼ í•©ë‹ˆë‹¤.

### `notifyOnChangePropsExclusion` has been removed

v4ì—ì„œ `notifyOnChangeProps`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `"tracked"` ë™ì‘ì„ ë”°ë¦…ë‹ˆë‹¤. ë”°ë¼ì„œ ë” ì´ìƒ `notifyOnChangePropsExclusion` ì˜µì…˜ì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

### Consistent behavior for `cancelRefetch`

`cancelRefetch` ì˜µì…˜ì€ ì´ì œ ëª¨ë“  í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ë˜ë©°, ê¸°ë³¸ê°’ì´ `true`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. `refetchQueries`ë‚˜ `invalidateQueries`ë¥¼ ì—°ì†ìœ¼ë¡œ í˜¸ì¶œí•˜ë©´ ì²« ë²ˆì§¸ í˜¸ì¶œì´ ì·¨ì†Œë˜ê³  ë‘ ë²ˆì§¸ í˜¸ì¶œì´ ì‹œì‘ë©ë‹ˆë‹¤:

```
queryClient.refetchQueries({ queryKey: ['todos'] })
// ì´ í˜¸ì¶œì€ ì´ì „ refetchë¥¼ ì·¨ì†Œí•˜ê³  ìƒˆ fetchë¥¼ ì‹œì‘í•©ë‹ˆë‹¤
queryClient.refetchQueries({ queryKey: ['todos'] })
```

ì´ ë™ì‘ì„ ì›í•˜ì§€ ì•Šìœ¼ë©´ `cancelRefetch: false`ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
queryClient.refetchQueries({ queryKey: ['todos'] })
// ì´ í˜¸ì¶œì€ ì´ì „ refetchë¥¼ ì·¨ì†Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
queryClient.refetchQueries({ queryKey: ['todos'] }, { cancelRefetch: false })
```

### Query Filters

ì¿¼ë¦¬ í•„í„°ëŠ” ì´ì œ ë‹¨ì¼ í•„í„°ë¡œ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ í•„í„°ëŠ” 'active', 'inactive', 'all' ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```tsx
- active?: boolean // [!code --]
- inactive?: boolean // [!code --]
+ type?: 'active' | 'inactive' | 'all' // [!code ++]
```

ì´ í•„í„°ëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œ `all`ì„ ì‚¬ìš©í•˜ë©°, `active` ë˜ëŠ” `inactive` ì¿¼ë¦¬ë§Œ ì„ íƒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

#### refetchActive / refetchInactive

`queryClient.invalidateQueries`ì˜ `refetchActive`ì™€ `refetchInactive` í”Œë˜ê·¸ë„ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤:

```tsx
- refetchActive?: boolean // [!code --]
- refetchInactive?: boolean // [!code --]
+ refetchType?: 'active' | 'inactive' | 'all' | 'none' // [!code ++]
```

ì´ í”Œë˜ê·¸ì˜ ê¸°ë³¸ê°’ì€ `active`ì´ë©°, ëª¨ë“  ì¿¼ë¦¬ë¥¼ ë¦¬í˜ì¹˜í•˜ì§€ ì•Šìœ¼ë ¤ë©´ `none` ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `onSuccess` is no longer called from `setQueryData`

`setQueryData`ì—ì„œ `onSuccess`ê°€ í˜¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ì œ `onSuccess`ëŠ” ìš”ì²­ì´ ìˆì„ ë•Œë§Œ í˜¸ì¶œë©ë‹ˆë‹¤. ë°ì´í„° í•„ë“œì˜ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•˜ë ¤ë©´ `useEffect`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```tsx
const { data } = useQuery({ queryKey, queryFn });
React.useEffect(() => mySideEffectHere(data), [data]);
```

### `persistQueryClient` and the corresponding persister plugins are no longer experimental and have been renamed

`createWebStoragePersistor`ì™€ `createAsyncStoragePersistor`ëŠ” ê°ê° [`createSyncStoragePersister`](../../plugins/createSyncStoragePersister)ì™€ [`createAsyncStoragePersister`](../../plugins/createAsyncStoragePersister)ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. `persistQueryClient`ëŠ” ì´ì œ ì‹¤í—˜ì ì´ì§€ ì•Šìœ¼ë©° `PersistQueryClient`ë¡œ ë¦¬íŒ©í† ë§ë˜ì—ˆìŠµë‹ˆë‹¤:

```tsx
- import { persistQueryClient } from 'react-query/persistQueryClient-experimental' // [!code --]
- import { createWebStoragePersistor } from 'react-query/createWebStoragePersistor-experimental' // [!code --]
- import { createAsyncStoragePersistor } from 'react-query/createAsyncStoragePersistor-experimental' // [!code --]

+ import { persistQueryClient } from '@tanstack/react-query-persist-client' // [!code ++]
+ import { createSyncStoragePersister } from '@tanstack/query-sync-storage-persister' // [!code ++]
+ import { createAsyncStoragePersister } from '@tanstack/query-async-storage-persister'  // [!code ++]
```

### The `cancel` method on promises is no longer supported

ê¸°ì¡´ì˜ `cancel` ë©”ì„œë“œ([êµ¬ë²„ì „ `cancel` ë©”ì„œë“œ](../query-cancellation#old-cancel-function))ëŠ” ë” ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ ë©”ì„œë“œëŠ” Promiseì— `cancel` í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¿¼ë¦¬ ì·¨ì†Œë¥¼ ì§€ì›í•˜ë„ë¡ í–ˆìœ¼ë‚˜ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œëŠ” [`AbortController` API](https://developer.mozilla.org/en-US/docs/Web/API/AbortController)ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ [`AbortSignal` ì¸ìŠ¤í„´ìŠ¤](https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal)ë¥¼ ì œê³µí•˜ëŠ” [ìƒˆë¡œìš´ API](../query-cancellation) (v3.30.0ì—ì„œ ë„ì…ë¨)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

### TypeScript

íƒ€ì…ì€ ì´ì œ TypeScript v4.1 ì´ìƒì„ ìš”êµ¬í•©ë‹ˆë‹¤.

### Supported Browsers

v4ë¶€í„° React QueryëŠ” ìµœì‹  ë¸Œë¼ìš°ì €ì— ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë¦¬ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•˜ì—¬ ë” í˜„ëŒ€ì ì´ê³  ì„±ëŠ¥ì´ ë›°ì–´ë‚˜ë©° ë” ì‘ì€ ë²ˆë“¤ì„ ìƒì„±í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ìš”êµ¬ ì‚¬í•­ì— ëŒ€í•´ì„œëŠ” [ì—¬ê¸°](../../installation#requirements)ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `setLogger` is removed

ì´ì „ì—ëŠ” `setLogger`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì „ì—­ì ìœ¼ë¡œ ë¡œê±°ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. v4ì—ì„œëŠ” ì´ í•¨ìˆ˜ê°€ `QueryClient`ë¥¼ ìƒì„±í•  ë•Œ ì„ íƒì  í•„ë“œë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx
- import { QueryClient, setLogger } from 'react-query'; // [!code --]
+ import { QueryClient } from '@tanstack/react-query'; // [!code ++]

- setLogger(customLogger) // [!code --]
- const queryClient = new QueryClient(); // [!code --]
+ const queryClient = new QueryClient({ logger: customLogger }) // [!code ++]
```

### No _default_ manual Garbage Collection server-side

v3ì—ì„œëŠ” React Queryê°€ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ 5ë¶„ ë™ì•ˆ ìºì‹œí•œ í›„, ìˆ˜ë™ìœ¼ë¡œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. ì´ ê¸°ë³¸ ì„¤ì •ì€ ì„œë²„ ì¸¡ React Queryì—ë„ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ë¡œ ì¸í•´ ë†’ì€ ë©”ëª¨ë¦¬ ì†Œë¹„ì™€ ìˆ˜ë™ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì™„ë£Œë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ê³¼ì •ì—ì„œ í”„ë¡œì„¸ìŠ¤ê°€ ë©ˆì¶”ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. v4ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„œë²„ ì¸¡ì˜ `cacheTime`ì´ `Infinity`ë¡œ ì„¤ì •ë˜ì–´ ìˆ˜ë™ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤ (NodeJS í”„ë¡œì„¸ìŠ¤ëŠ” ìš”ì²­ì´ ì™„ë£Œë˜ë©´ ëª¨ë“  ê²ƒì„ ìë™ìœ¼ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤).

ì´ ë³€ê²½ ì‚¬í•­ì€ Next.jsì™€ ê°™ì€ ì„œë²„ ì¸¡ React Query ì‚¬ìš©ìì˜ ê²½ìš°ì—ë§Œ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. `cacheTime`ì„ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•˜ê³  ìˆë‹¤ë©´ ì˜í–¥ì„ ë°›ì§€ ì•Šì§€ë§Œ (ë™ì‘ì„ ë§ì¶”ëŠ” ê²ƒì´ ì¢‹ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤).

### Logging in production

v4ë¶€í„° react-queryëŠ” í”„ë¡œë•ì…˜ ëª¨ë“œì—ì„œ ì½˜ì†”ì— ì˜¤ë¥˜(ì˜ˆ: ì‹¤íŒ¨í•œ ìš”ì²­)ë¥¼ ë” ì´ìƒ ê¸°ë¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” ë§ì€ ì‚¬ìš©ìì—ê²Œ í˜¼ë€ì„ ì´ˆë˜í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ì˜¤ë¥˜ëŠ” ì—¬ì „íˆ ê°œë°œ ëª¨ë“œì—ì„œ í‘œì‹œë©ë‹ˆë‹¤.

### ESM Support

React QueryëŠ” ì´ì œ [package.json `"exports"`](https://nodejs.org/api/packages.html#exports)ë¥¼ ì§€ì›í•˜ë©° Nodeì˜ ê¸°ë³¸ CommonJS ë° ESM í•´ìƒë„ì™€ ì™„ì „íˆ í˜¸í™˜ë©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìì—ê²ŒëŠ” ì£¼ìš” ë³€ê²½ ì‚¬í•­ì´ ì—†ê² ì§€ë§Œ, í”„ë¡œì íŠ¸ì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” íŒŒì¼ì´ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ì§„ì…ì ìœ¼ë¡œ ì œí•œë©ë‹ˆë‹¤.

### Streamlined NotifyEvents

`QueryCache`ì— ìˆ˜ë™ìœ¼ë¡œ êµ¬ë…í•  ë•Œ `QueryCacheNotifyEvent`ë¥¼ ë°›ì„ ìˆ˜ ìˆì—ˆì§€ë§Œ, `MutationCache`ì—ëŠ” ì ìš©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ì œëŠ” ë™ì‘ì„ ê°„ì†Œí™”í•˜ê³  ì´ë²¤íŠ¸ ì´ë¦„ë„ ì´ì— ë§ê²Œ ì¡°ì •í–ˆìŠµë‹ˆë‹¤.

#### QueryCacheNotifyEvent

```tsx
- type: 'queryAdded' // [!code --]
+ type: 'added' // [!code ++]
- type: 'queryRemoved' // [!code --]
+ type: 'removed' // [!code ++]
- type: 'queryUpdated' // [!code --]
+ type: 'updated' // [!code ++]
```

#### MutationCacheNotifyEvent

`MutationCacheNotifyEvent`ëŠ” `QueryCacheNotifyEvent`ì™€ ë™ì¼í•œ íƒ€ì…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

> ì°¸ê³ : ì´ ë‚´ìš©ì€ `queryCache.subscribe` ë˜ëŠ” `mutationCache.subscribe`ë¥¼ í†µí•´ ìºì‹œì— ìˆ˜ë™ìœ¼ë¡œ êµ¬ë…í•˜ëŠ” ê²½ìš°ì—ë§Œ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.

### Separate hydration exports have been removed

ë²„ì „ [3.22.0](https://github.com/tannerlinsley/react-query/releases/tag/v3.22.0)ë¶€í„°, hydration ìœ í‹¸ë¦¬í‹°ëŠ” React Query ì½”ì–´ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤. v3ì—ì„œëŠ” ì—¬ì „íˆ `react-query/hydration`ì—ì„œ êµ¬ë²„ì „ ë‚´ë³´ë‚´ê¸°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆì§€ë§Œ, v4ì—ì„œëŠ” ì´ëŸ¬í•œ ë‚´ë³´ë‚´ê¸°ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx
- import { dehydrate, hydrate, useHydrate, Hydrate } from 'react-query/hydration' // [!code --]
+ import { dehydrate, hydrate, useHydrate, Hydrate } from '@tanstack/react-query' // [!code ++]
```

### Removed undocumented methods from the `queryClient`, `query` and `mutation`

`QueryClient`ì˜ `cancelMutatations`ì™€ `executeMutation` ë©”ì„œë“œëŠ” ë¬¸ì„œí™”ë˜ì§€ ì•Šì•˜ê³  ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ë©”ì„œë“œëŠ” `mutationCache`ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œì˜ ë˜í¼ì— ë¶ˆê³¼í•˜ë¯€ë¡œ, `executeMutation`ì˜ ê¸°ëŠ¥ì€ ì—¬ì „íˆ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
- executeMutation< // [!code --]
-   TData = unknown, // [!code --]
-   TError = unknown, // [!code --]
-   TVariables = void, // [!code --]
-   TContext = unknown // [!code --]
- >( // [!code --]
-   options: MutationOptions<TData, TError, TVariables, TContext> // [!code --]
- ): Promise<TData> { // [!code --]
-   return this.mutationCache.build(this, options).execute() // [!code --]
- } // [!code --]
```

ì¶”ê°€ë¡œ, `query.setDefaultOptions`ê°€ ì‚¬ìš©ë˜ì§€ ì•Šì•„ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. `mutation.cancel`ì€ ì‹¤ì œë¡œ ìš”ì²­ì„ ì·¨ì†Œí•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.

### The `src/react` directory was renamed to `src/reactjs`

ì´ì „ì—ëŠ” React Queryê°€ `react`ë¼ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ê°€ì§€ê³  ìˆì—ˆê³ , ì´ëŠ” `react` ëª¨ë“ˆì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ì´ëŠ” ì¼ë¶€ Jest êµ¬ì„±ê³¼ ì¶©ëŒì„ ì¼ìœ¼í‚¬ ìˆ˜ ìˆì–´, ë‹¤ìŒê³¼ ê°™ì€ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤:

```
TypeError: Cannot read property 'createContext' of undefined
```

ë””ë ‰í† ë¦¬ ì´ë¦„ì´ ë³€ê²½ë¨ì— ë”°ë¼ ë” ì´ìƒ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ì—ì„œ `'react-query/react'`ì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ë˜ ê²½ìš° (ë‹¨ìˆœíˆ `'react-query'`ê°€ ì•„ë‹Œ ê²½ìš°), ê°€ì ¸ì˜¤ê¸°ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤:

```tsx
- import { QueryClientProvider } from 'react-query/react'; // [!code --]
+ import { QueryClientProvider } from '@tanstack/react-query/reactjs'; // [!code ++]
```

## New Features ğŸš€

v4ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë©‹ì§„ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤:

### Support for React 18

React 18ì´ ì˜¬í•´ ì´ˆì— ì¶œì‹œë˜ì—ˆìœ¼ë©°, v4ëŠ” ì´ì œ ì´ë¥¼ ì™„ë²½íˆ ì§€ì›í•˜ë©° ìƒˆë¡œìš´ ë™ì‹œì„± ê¸°ëŠ¥ë„ ì œê³µí•©ë‹ˆë‹¤.

### Proper offline support

v3ì—ì„œëŠ” React Queryê°€ ì¿¼ë¦¬ì™€ ë³€ì´ë¥¼ ì‹¤í–‰í•œ í›„ ì¸í„°ë„·ì— ì—°ê²°ë˜ì–´ ìˆì–´ì•¼ ì¬ì‹œë„í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í–ˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì—¬ëŸ¬ ê°€ì§€ í˜¼ë€ìŠ¤ëŸ¬ìš´ ìƒí™©ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤:

- ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ì¿¼ë¦¬ë¥¼ ë§ˆìš´íŠ¸í•˜ë©´ ë¡œë”© ìƒíƒœë¡œ ì „í™˜ë˜ê³  ìš”ì²­ì´ ì‹¤íŒ¨í•˜ë©°, ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë‹¤ì‹œ ì˜¨ë¼ì¸ ìƒíƒœê°€ ë  ë•Œê¹Œì§€ ë¡œë”© ìƒíƒœë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
- ë¹„ìŠ·í•˜ê²Œ, ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ì¬ì‹œë„ê°€ êº¼ì ¸ ìˆëŠ” ê²½ìš°, ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì—ˆë‹¤ê°€ ì‹¤íŒ¨í•˜ë©° ì˜¤ë¥˜ ìƒíƒœë¡œ ì „í™˜ë©ë‹ˆë‹¤.
- ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ í•„ìš” ì—†ëŠ” ì¿¼ë¦¬ë¥¼ ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ, ì¿¼ë¦¬ê°€ ë‹¤ë¥¸ ì´ìœ ë¡œ ì‹¤íŒ¨í•˜ë©´ ì´ì œëŠ” ì˜¨ë¼ì¸ ìƒíƒœê°€ ë  ë•Œê¹Œì§€ ì¼ì‹œ ì¤‘ì§€ë©ë‹ˆë‹¤.
- ì°½ í¬ì»¤ìŠ¤ ì¬ìš”ì²­ì´ ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œëŠ” ì•„ë¬´ëŸ° ë™ì‘ì„ í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

v4ì—ì„œëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ `networkMode`ë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ [Network mode](../network-mode)ì— ëŒ€í•œ í˜ì´ì§€ë¥¼ ì°¸ì¡°í•˜ì—¬ ë” ë§ì€ ì •ë³´ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.

### Tracked Queries per default

React QueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¿¼ë¦¬ ì†ì„±ì„ "ì¶”ì "í•˜ì—¬ ë Œë”ë§ ìµœì í™”ë¥¼ ê°œì„ í•©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ [v3.6.0](https://github.com/tannerlinsley/react-query/releases/tag/v3.6.0)ë¶€í„° ì¡´ì¬í•´ì™”ìœ¼ë©°, v4ì—ì„œ ê¸°ë³¸ ë™ì‘ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.

### Bailing out of updates with setQueryData

[setQueryDataì˜ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ì](../../../../reference/QueryClient/#queryclientsetquerydata)ë¥¼ ì‚¬ìš©í•  ë•Œ, `undefined`ë¥¼ ë°˜í™˜í•˜ì—¬ ì—…ë°ì´íŠ¸ë¥¼ ì¤‘ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” `undefined`ê°€ `previousValue`ë¡œ ì œê³µë˜ì–´ í˜„ì¬ ìºì‹œëœ í•­ëª©ì´ ì—†ê³  ìƒì„±í•  ìˆ˜ ì—†ì„ ë•Œ ìœ ìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í•  ì¼ì„ í† ê¸€í•˜ëŠ” ê²½ìš° ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```tsx
queryClient.setQueryData(["todo", id], (previousTodo) =>
  previousTodo ? { ...previousTodo, done: true } : undefined
);
```

### Mutation Cache Garbage Collection

ì´ì œ mutationë„ ì¿¼ë¦¬ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ìë™ìœ¼ë¡œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì— ì˜í•´ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€ì´ì˜ ê¸°ë³¸ `cacheTime`ì€ 5ë¶„ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### Custom Contexts for Multiple Providers

ì—¬ëŸ¬ React Query `Provider` ì¸ìŠ¤í„´ìŠ¤ê°€ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì— ìˆì„ ë•Œ, í›…ê³¼ ë§ëŠ” `Provider`ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ì§€ì • ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” í›…ì´ ì˜¬ë°”ë¥¸ `Provider` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³´ì¥í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤.

ì˜ˆì‹œ:

1. ë°ì´í„° íŒ¨í‚¤ì§€ ìƒì„±.

```tsx
// ì²« ë²ˆì§¸ ë°ì´í„° íŒ¨í‚¤ì§€: @my-scope/container-data

const context = React.createContext<QueryClient | undefined>(undefined);
const queryClient = new QueryClient();

export const useUser = () => {
  return useQuery(USER_KEY, USER_FETCHER, {
    context,
  });
};

export const ContainerDataProvider = ({
  children,
}: {
  children: React.ReactNode;
}) => {
  return (
    <QueryClientProvider client={queryClient} context={context}>
      {children}
    </QueryClientProvider>
  );
};
```

2. ë‘ ë²ˆì§¸ ë°ì´í„° íŒ¨í‚¤ì§€ ìƒì„±.

```tsx
// ë‘ ë²ˆì§¸ ë°ì´í„° íŒ¨í‚¤ì§€: @my-scope/my-component-data

const context = React.createContext<QueryClient | undefined>(undefined);
const queryClient = new QueryClient();

export const useItems = () => {
  return useQuery(ITEMS_KEY, ITEMS_FETCHER, {
    context,
  });
};

export const MyComponentDataProvider = ({
  children,
}: {
  children: React.ReactNode;
}) => {
  return (
    <QueryClientProvider client={queryClient} context={context}>
      {children}
    </QueryClientProvider>
  );
};
```

3. ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë‘ ë°ì´í„° íŒ¨í‚¤ì§€ ì‚¬ìš©.

```tsx
// ì• í”Œë¦¬ì¼€ì´ì…˜

import { ContainerDataProvider, useUser } from "@my-scope/container-data";
import { AppDataProvider } from "@my-scope/app-data";
import { MyComponentDataProvider, useItems } from "@my-scope/my-component-data";

<ContainerDataProvider> // <-- ìì‹ ì˜ React Query providerë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ë°ì´í„°(ì˜ˆ: "user") ì œê³µ
  ...
  <AppDataProvider> // <-- ìì‹ ì˜ React Query providerë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° ì œê³µ (ì´ ì˜ˆì œì—ì„œëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)
    ...
      <MyComponentDataProvider> // <-- ìì‹ ì˜ React Query providerë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ë°ì´í„°(ì˜ˆ: "items") ì œê³µ
        <MyComponent />
      </MyComponentDataProvider>
    ...
  </AppDataProvider>
  ...
</ContainerDataProvider>

// ìœ„ "DataProvider" ì»´í¬ë„ŒíŠ¸ì—ì„œ ì œê³µí•˜ëŠ” í›…ì˜ ì˜ˆ:
const MyComponent = () => {
  const user = useUser() // <-- ContainerDataProviderì—ì„œ ì§€ì •í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  const items = useItems() // <-- MyComponentDataProviderì—ì„œ ì§€ì •í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  ...
}
```
